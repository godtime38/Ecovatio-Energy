<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Crop Favicon</title>
</head>

<body>
    <h1>Cropping Favicon...</h1>
    <p>Please wait while the image is being processed.</p>
    <canvas id="canvas" style="display:none;"></canvas>
    <a id="download" style="display:none;">Download Cropped Image</a>

    <script>
        window.onload = function () {
            const img = new Image();
            img.src = 'assets/img/favicon.png'; // Load the original image

            img.onload = function () {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;

                let minX = canvas.width;
                let minY = canvas.height;
                let maxX = 0;
                let maxY = 0;

                for (let y = 0; y < canvas.height; y++) {
                    for (let x = 0; x < canvas.width; x++) {
                        const alpha = data[(y * canvas.width + x) * 4 + 3];
                        if (alpha > 0) {
                            if (x < minX) minX = x;
                            if (x > maxX) maxX = x;
                            if (y < minY) minY = y;
                            if (y > maxY) maxY = y;
                        }
                    }
                }

                const croppedWidth = maxX - minX + 1;
                const croppedHeight = maxY - minY + 1;

                // Make it square
                const size = Math.max(croppedWidth, croppedHeight);
                const offsetX = (size - croppedWidth) / 2;
                const offsetY = (size - croppedHeight) / 2;

                const croppedCanvas = document.createElement('canvas');
                croppedCanvas.width = size;
                croppedCanvas.height = size;
                const croppedCtx = croppedCanvas.getContext('2d');

                // Draw cropped image onto new canvas
                croppedCtx.drawImage(
                    canvas,
                    minX, minY, croppedWidth, croppedHeight,
                    offsetX, offsetY, croppedWidth, croppedHeight
                );

                const dataUrl = croppedCanvas.toDataURL('image/png');

                const a = document.getElementById('download');
                a.href = dataUrl;
                a.download = 'favicon_fixed.png';
                a.style.display = 'block';
                a.innerText = 'Click here to download the fixed favicon';

                // Auto click
                a.click();
                document.body.innerHTML += '<p>Done! Check your downloads folder for favicon_fixed.png.</p>';
            };
        };
    </script>
</body>

</html>